<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="Review">

<select id="getReviewCountByMemberId" parameterType="int" resultType="int">
	select COUNT(*)
	from review
	where renter_id = #{memberId}
	order by rdate DESC
</select>

<!-- 작성해야할 후기 목록 -->
<select id="reviewList" parameterType="Integer" resultType="com.sharebridge.dto.RequestDto">
	select product_id, member_id
	<!-- DATE_FORMAT(sdate, '%Y-%m-%d %H:%i:%s') AS sdate, -->
	<!-- DATE_FORMAT(edate, '%Y-%m-%d %H:%i:%s') AS edate -->
	from request
	where member_id=${memberId} and is_accept=1
	order by rdate desc
</select>

<!-- 후기 목록2(상품명, 렌터번호, 금액) -->
<select id="reviewListTwo" parameterType="Integer" resultType="com.sharebridge.dto.ProductDto">
	select member_id, title, price, product_id
	from product
	where product_id=#{product_id}
</select>

<!-- 후기 목록3(렌터 닉네임) -->
<select id="reviewListThree" parameterType="Integer" resultType="String">
	select nickname
	from member
	where member_id=#{member_id}
</select>

<!-- 후기 작성 -->
<insert id="writeRev" parameterType="com.sharebridge.dto.ReviewDto">
	insert into review(review_id, product_id, renter_id, rentee_id, content, rating, photo, rdate)
	values((select ifnull(max(review_id), 0)+1 from review b), #{product_id}, #{renter_id}, #{rentee_id}, #{content}, #{rating}, null, now())
</insert>

</mapper>